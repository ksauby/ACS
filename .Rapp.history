population_6 <- patch_data_summary_wide %>% filter(population==6)
head(patch_data)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
patch_data_6 <- patch_data %>% filter(population==6)
names(patch_data)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
mean(patch_data_6$Old_Moth_Evidence_Stricta)
head(population_6)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean
names(simdata_all_re)
head(simdata_all_re)
population_6
head(simdata_all_re)
12+36+34+10+300+18+5
2/415
300+10+18+5
9+36+34+300+18+5
300/365
302/365
names(simdata_all_re)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population_6$Old_Moth_Evidence_Stricta_ratio_mean
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
(#
		# observed#
		simdata_all_re$Old_Moth_Evidence_Stricta_ratio_mean_observed - #
		# true#
		population_6$Old_Moth_Evidence_Stricta_ratio_mean#
	)^2
302.4/365
300/365
302.4/365 - 300/365
302.4/365*100 - 300/365*100
head(simdata_all_re)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100#
) %>% dim
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
) %>% dim
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
) %>% head
5/365
5/365*100
18/365
14*3/365
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
ovar
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
rvar
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simulation_data_summary_table_re = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.SRSWOR.plots", "SamplingDesign", "Plots"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simulation_data_summary_table_re = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.SRSWOR.plots", "SamplingDesign", "Plots"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simulation_data_summary_table_re
simulation_data_summary_table_re
head(sim_data_6_100_ACS)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# CONFIRM OLD MOTH EVIDENCE MEAN CALCULATED CORRECTLY#
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean#
#
# MANUALLY CALCULATE RE OF OLD MOTH EVIDENCE#
#
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)#
#
mean_MSE <- sum(#
	(#
		# observed#
		sim_data_6_100_ACS$Old_Moth_Evidence_Stricta_ratio_mean_observed - #
		# true#
		population_6$Old_Moth_Evidence_Stricta_ratio_mean#
	)^2#
)/dim(sim_data_6_100_ACS)[1] # n_sims#
RE = (#
	Old_Moth_Evidence_Stricta_ratio_var/mean(sim_data_6_100_ACS$N.Total.plots) *#
	(1 - mean(sim_data_6_100_ACS$N.Total.plots)/900)#
)#
/	mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
(#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/mean(sim_data_6_100_ACS$N.Total.plots) *#
	(1 - mean(sim_data_6_100_ACS$N.Total.plots)/900)#
)#
/	mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
(#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/mean(sim_data_6_100_ACS$N.Total.plots) *#
	(1 - mean(sim_data_6_100_ACS$N.Total.plots)/900)#
) /	mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.SRSWOR.plots", "SamplingDesign", "Plots"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
mean(sim_data_6_100_ACS$N.Total.plots)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
RE_values <- calculateRE(#
	population_data = patch_data_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
example_bias = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.SRSWOR.plots", "SamplingDesign", "Plots"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)#
RE_values <- calculateRE(#
	population_data = patch_data_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
head(example_bias)
names(example_bias)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# CONFIRM OLD MOTH EVIDENCE MEAN CALCULATED CORRECTLY#
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean#
#
# MANUALLY CALCULATE RE OF OLD MOTH EVIDENCE#
#
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)
names(sim_data_6_100_ACS)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
example_bias = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.SRSWOR.plots", "SamplingDesign", "Plots"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)#
RE_values <- calculateRE(
)
head(example_bias)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
RE_values <- calculateRE(#
	population_data = patch_data_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simulation_data_summary_table_re = calculateSamplingBias(#
	population_data_summary	= patch_data_summary_wide, #
	simulation_data		= simdata_all_re, #
	sampling.grouping.variables	= sampling.grouping.variables, #
	population.grouping.variables = population.grouping.variables,#
	ovar			= ovar, #
	rvar				= rvar#
)#
RE_values <- calculateRE(#
	population_data = patch_data,#
	MSE_ComparisonSamplingDesign = simulation_data_summary_table_re,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = rvar#
)
5/365
5/365*100
11.49/3
14/120
14/365
14*3/365
18/365
300/365
3.83*3
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
simulation_data_summary_table_new_y_HT_re <- calculateSamplingBias(#
	population_data_summary	= patch_data_summary_wide, #
	simulation_data		= simdata_new_yHT_re, #
	sampling.grouping.variables	= sampling.grouping.variables, #
	population.grouping.variables = population.grouping.variables,#
	ovar				= ovar, #
	rvar				= rvar#
)#
#
RE_values <- calculateRE(#
	population_data = patch_data,#
	MSE_ComparisonSamplingDesign = simulation_data_summary_table_new_y_HT_re,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	rvar = rvar,#
	ovar = ovar#
)
head(simulation_data_summary_table_new_y_HT_re)
population.grouping.variables
sampling.grouping.variables
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
example_bias = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.Total.plots_mean" "N.SRSWOR.plots"     "SamplingDesign"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)#
RE_values <- calculateRE(#
	population_data = patch_data_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
example_bias = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.Total.plots_mean", "N.SRSWOR.plots",     "SamplingDesign"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)#
RE_values <- calculateRE(#
	population_data = patch_data_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
RE_values
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# CONFIRM OLD MOTH EVIDENCE MEAN CALCULATED CORRECTLY#
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean#
#
# MANUALLY CALCULATE RE OF OLD MOTH EVIDENCE#
#
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)#
#
mean_MSE <- sum(#
	(#
		# observed#
		sim_data_6_100_ACS$Old_Moth_Evidence_Stricta_ratio_mean_observed - #
		# true#
		population_6$Old_Moth_Evidence_Stricta_ratio_mean#
	)^2#
)/dim(sim_data_6_100_ACS)[1] # n_sims
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
(#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/mean(sim_data_6_100_ACS$N.Total.plots) *#
	(1 - mean(sim_data_6_100_ACS$N.Total.plots)/900)#
) /	mean_MSE
example_bias
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
example_bias
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
(#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/example_bias$N.Total.plots_mean *#
	(1 - example_bias$N.Total.plots_mean/900)#
) /	mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
MSE_ComparisonSamplingDesign = example_bias
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population_data = patch_data_6
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
sample.size.variable = "N.Total.plots_mean"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
rvar = "Old_Moth_Evidence_Stricta"
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X <- NULL#
	X <- MSE_ComparisonSamplingDesign#
	if (sample.size.variable %in% names(X)) {#
		colnames(X)[names(X) == sample.size.variable] <- "sample.size.variable"#
	}
setwd('/Users/KSauby/Documents/Projects/ACS/R')
dimensions <- population_data %>% #
		group_by_(.dots=population.grouping.variables) %>%#
		summarise(N = n())#
	# variances of populations#
	if (!is.null(ovar)) {#
		variances <- population_data %>% #
			dplyr::select_(.dots=c(#
				population.grouping.variables,#
				ovar,#
				rvar#
			)) %>%#
			group_by_(.dots=population.grouping.variables) %>% #
			summarise_all(funs(var(., na.rm=T)))#
		setnames(#
			variances,#
			names(variances)[#
				(length(population.grouping.variables) + 1):#
				length(names(variances))#
			], #
			paste(names(variances)[#
					(length(population.grouping.variables) + 1):#
					length(names(variances))#
				],#
				"var",#
				sep="_"#
			)#
		)	#
	}#
	if (!is.null(rvar)) {#
		# should I only calculate this using samples that included at least one unit with cactus species?#
		variances_ratio <- population_data %>% #
			filter(Stricta==1) %>%#
			dplyr::select_(.dots=c(#
				population.grouping.variables,#
				rvar#
			)) %>%#
			group_by_(.dots=population.grouping.variables) %>% #
			summarise_all(funs(var(., na.rm=T)))#
		setnames(#
			variances_ratio,#
			names(variances_ratio)[#
				(length(population.grouping.variables) + 1):#
				length(names(variances_ratio))#
			], #
			paste(names(variances_ratio)[#
					(length(population.grouping.variables) + 1):#
					length(names(variances_ratio))#
				],#
				"ratio_var",#
				sep="_"#
			)#
		)	#
	}#
	Y <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))#
	# calculate var_y_bar#
	if (!is.null(rvar) & is.null(ovar)) {#
		Y %<>% #
			merge(dimensions, by=population.grouping.variables) %>%#
			merge(variances_ratio, by=population.grouping.variables)#
	}#
	if (is.null(rvar) & !is.null(ovar)) {#
		Y %<>% #
			merge(dimensions, by=population.grouping.variables) %>%#
			merge(variances, by=population.grouping.variables)#
	}#
	if (!is.null(rvar) & !is.null(ovar)) {#
		Y %<>% #
			merge(dimensions, by=population.grouping.variables) %>%#
			merge(variances, by=population.grouping.variables) %>%#
			merge(variances_ratio, by=population.grouping.variables)#
	}
setwd('/Users/KSauby/Documents/Projects/ACS/R')
A <- Y %>% #
		dplyr::select(-one_of(paste(ovar, "_var", sep=""))) %>%#
		dplyr::select(-one_of(paste(rvar, "_ratio_var", sep=""))) %>%#
		dplyr::select(-one_of(paste(rvar, "_var", sep="")))
names(A)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
B <- Y %>% #
		dplyr::select(-one_of(#
			paste(ovar, "_mean_MSE", sep=""),#
			paste(rvar, "_ratio_mean_MSE", sep=""),		#
			paste(rvar, "_var", sep="")		#
		))
names(B)
population_6
dim(B)
B
population_6
names(patch_data_summary_wide)
str(patch_data_summary)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
patch_data_summary[[2]] %>%#
	dplyr::select(Var, variable, population) %>%#
	rowwise() %>%#
	mutate(#
		variable = replace(#
			variable,#
			which(variable %in% rvar),#
			paste(variable, "ratio", sep="_")#
			)#
	) %>%#
	ungroup() %>%#
	reshape2::dcast(., population ~ variable, value.var="Var")
head(patch_data_summary[[2]] %>%#
	dplyr::select(Var, variable, population))
head(patch_data_summary_wide)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population.grouping.variables	<- c("population")#
sampling.grouping.variables <- c("N.SRSWOR.plots", "SamplingDesign", "Plots")#
statistics 			<- c("mean", "var")#
ratio.statistics	<- c("mean")#
#
# variance#
A <- patch_data_summary[[2]] %>%#
	dplyr::select(Var, variable, population) %>%#
	rowwise() %>%#
	mutate(#
		variable = replace(#
			variable,#
			which(variable %in% rvar),#
			paste(variable, "ratio", sep="_")#
			)#
	) %>%#
	ungroup() %>%#
	reshape2::dcast(., population ~ variable, value.var="Var")#
names(A)[2:10] <- paste(names(A)[2:10], "var", sep="_")#
# mean#
B <- patch_data_summary[[2]] %>%#
	dplyr::select(Mean, variable, population) %>%#
	rowwise() %>%#
	mutate(#
		variable = replace(#
			variable,#
			which(variable %in% rvar),#
			paste(variable, "ratio", sep="_")#
			)#
	) %>%#
	ungroup() %>%#
	reshape2::dcast(., population ~ variable, value.var="Mean")#
names(B)[2:10] <- paste(names(B)[2:10], "mean", sep="_")#
patch_data_summary_wide <- merge(A, B) %>% mutate(N=900)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# CONFIRM OLD MOTH EVIDENCE MEAN CALCULATED CORRECTLY#
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean#
#
# MANUALLY CALCULATE RE OF OLD MOTH EVIDENCE#
#
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
mean_MSE <- sum(#
	(#
		# observed#
		sim_data_6_100_ACS$Old_Moth_Evidence_Stricta_ratio_mean_observed - #
		# true#
		population_6$Old_Moth_Evidence_Stricta_ratio_mean#
	)^2#
)/dim(sim_data_6_100_ACS)[1] # n_sims#
RE = (#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/example_bias$N.Total.plots_mean *#
	(1 - example_bias$N.Total.plots_mean/900)#
) /	mean_MSE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population_data = population_6
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
MSE_ComparisonSamplingDesign = example_bias
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population.grouping.variables = "population"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
sample.size.variable = "N.Total.plots_mean"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
rvar = "Old_Moth_Evidence_Stricta"
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population.grouping.variables
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Y <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))
head(Y)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X <- NULL#
	X <- MSE_ComparisonSamplingDesign#
	if (sample.size.variable %in% names(X)) {#
		colnames(X)[names(X) == sample.size.variable] <- "sample.size.variable"#
	}#
#
	Y <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))
head(Y)
dim(Y)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
MSE_ComparisonSamplingDesign = example_bias
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population_data = population_6
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
population.grouping.variables = "population"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
sample.size.variable = "N.Total.plots_mean"
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
rvar = "Old_Moth_Evidence_Stricta"
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X <- NULL#
	X <- MSE_ComparisonSamplingDesign#
	if (sample.size.variable %in% names(X)) {#
		colnames(X)[names(X) == sample.size.variable] <- "sample.size.variable"#
	}#
#
	Y <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))
dim(Y)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Y %>% #
		dplyr::select(-one_of(paste(ovar, "_var", sep=""))) %>%#
		dplyr::select(-one_of(paste(rvar, "_ratio_var", sep=""))) %>%#
		dplyr::select(-one_of(paste(rvar, "_var", sep=""))) %>%#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N",#
				"sample.size.variable"#
			),#
			value.name="mean_MSE"#
		)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Y <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))#
	Y$variable <- sub("*_mean_MSE", "", Y$variable)
Y
setwd('/Users/KSauby/Documents/Projects/ACS/R')
sub("*_mean_MSE", "", Y$variable)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	))
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	)) %>%#
	reshape2:::melt.data.frame(#
		data=.,#
		id.vars=c(#
			population.grouping.variables,#
			"N",#
			"sample.size.variable"#
		),#
		value.name="mean_MSE"#
	)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	)) %>%#
	reshape2:::melt.data.frame(#
		data=.,#
		id.vars=c(#
			population.grouping.variables,#
			"sample.size.variable"#
		),#
		value.name="mean_MSE"#
	)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			"sample.size.variable",#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		))
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		))
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		)) %>%			#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N",#
			),#
			value.name="population_variance"#
		)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		)) %>%			#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N"#
			),#
			value.name="population_variance"#
		)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		)) %>%			#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N"#
			),#
			value.name="population_variance"#
		)
? reshape2:::melt.data.frame
setwd('/Users/KSauby/Documents/Projects/ACS/R')
A <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	)) %>%#
	reshape2:::melt.data.frame(#
		data=.,#
		id.vars=c(#
			population.grouping.variables,#
			"sample.size.variable"#
		),#
		value.name="mean_MSE"#
	)#
	A$variable <- sub("*_mean_MSE", "", A$variable)
A
setwd('/Users/KSauby/Documents/Projects/ACS/R')
B <- population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		)) %>%			#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N"#
			),#
			value.name="population_variance"#
		)	#
		B$variable <- sub("*_var", "", B$variable)
B
A
setwd('/Users/KSauby/Documents/Projects/ACS/R')
A %>%#
		merge(#
			B, #
			by=c(#
				population.grouping.variables, #
				"variable"#
			)#
		)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Z %<>% mutate(#
		RE = (#
			population_variance/sample.size.variable *#
			(1 - sample.size.variable/N)#
		)#
		/	mean_MSE#
	)
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Z <- A %>%#
		merge(#
			B, #
			by=c(#
				population.grouping.variables, #
				"variable"#
			)#
		)#
	# calculate efficiency#
	Z %<>% mutate(#
		RE = (#
			population_variance/sample.size.variable *#
			(1 - sample.size.variable/N)#
		)#
		/	mean_MSE#
	)
Z
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Z$variable <- paste(Z$variable, "_RE", sep="")
Z
setwd('/Users/KSauby/Documents/Projects/ACS/R')
Z %<>%#
	reshape2::dcast(#
		list(#
			c(population.grouping.variables, "N", "sample.size.variable"),#
			c("variable")#
		),#
		value.var="RE"#
		)
Z
setwd('/Users/KSauby/Documents/Projects/ACS/R')
colnames(Z)[names(Z) == "sample.size.variable"] <- sample.size.variable
Z
setwd('/Users/KSauby/Documents/Projects/ACS/R')
#' Calculate Relative Efficiency (RE)#
#' #
#' @param MSE_ComparisonSamplingDesign Sampling design for which relative efficiency (RE) should be calculated.#
#' @param MSE_BaselineSamplingDesign The sampling design to which the "comparison sampling design" is compared to and its efficiency, relative to this one, is calculated.#
#' @param grouping.variables Categorical variables identifying the patch realization from which the simulation data was generated (e.g., \code{n.networks} and \code{realization}).#
#' @return Dataframe including original data and RE estimates.#
#' @export#
# dimensions of populations#
# dimensions <- population_data %>% #
#	group_by_(.dots=population.grouping.variables) %>%#
#	summarise(N = n())#
# variances of populations#
if (!is.null(ovar)) {#
	variances <- population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			ovar,#
			rvar#
		)) %>%#
		group_by_(.dots=population.grouping.variables) %>% #
		summarise_all(funs(var(., na.rm=T)))#
	setnames(#
		variances,#
		names(variances)[#
			(length(population.grouping.variables) + 1):#
			length(names(variances))#
		], #
		paste(names(variances)[#
				(length(population.grouping.variables) + 1):#
				length(names(variances))#
			],#
			"var",#
			sep="_"#
		)#
	)	#
}#
if (!is.null(rvar)) {#
	# should I only calculate this using samples that included at least one unit with cactus species?#
	variances_ratio <- population_data %>% #
		filter(Stricta==1) %>%#
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			rvar#
		)) %>%#
		group_by_(.dots=population.grouping.variables) %>% #
		summarise_all(funs(var(., na.rm=T)))#
	setnames(#
		variances_ratio,#
		names(variances_ratio)[#
			(length(population.grouping.variables) + 1):#
			length(names(variances_ratio))#
		], #
		paste(names(variances_ratio)[#
				(length(population.grouping.variables) + 1):#
				length(names(variances_ratio))#
			],#
			"ratio_var",#
			sep="_"#
		)#
	)	#
}#
# calculate var_y_bar#
if (!is.null(rvar) & is.null(ovar)) {#
	Y %<>% #
		merge(dimensions, by=population.grouping.variables) %>%#
		merge(variances_ratio, by=population.grouping.variables)#
}#
if (is.null(rvar) & !is.null(ovar)) {#
	Y %<>% #
		merge(dimensions, by=population.grouping.variables) %>%#
		merge(variances, by=population.grouping.variables)#
}#
if (!is.null(rvar) & !is.null(ovar)) {#
	Y %<>% #
		merge(dimensions, by=population.grouping.variables) %>%#
		merge(variances, by=population.grouping.variables) %>%#
		merge(variances_ratio, by=population.grouping.variables)#
}#
calculateRE <- function(#
	MSE_ComparisonSamplingDesign,#
	population_data,#
	population.grouping.variables,#
	sample.size.variable,#
	rvar,#
	ovar#
) {	#
	X <- NULL#
	X <- MSE_ComparisonSamplingDesign#
	if (sample.size.variable %in% names(X)) {#
		colnames(X)[names(X) == sample.size.variable] <- "sample.size.variable"#
	}#
	# "long" format of mean MSE#
	A <- X %>% dplyr::select_(.dots=c(#
		population.grouping.variables,#
		"sample.size.variable",#
		paste(ovar, "_mean_MSE", sep=""),#
		paste(rvar, "_ratio_mean_MSE", sep="")		#
	)) %>%#
	reshape2:::melt.data.frame(#
		data=.,#
		id.vars=c(#
			population.grouping.variables,#
			"sample.size.variable"#
		),#
		value.name="mean_MSE"#
	)#
	A$variable <- sub("*_mean_MSE", "", A$variable)#
	# "long" format of population variance#
	B <- population_data %>% #
		dplyr::select_(.dots=c(#
			population.grouping.variables,#
			paste(ovar, "_var", sep=""),#
			paste(rvar, "_ratio_var", sep=""),#
			"N"#
		)) %>%			#
		reshape2:::melt.data.frame(#
			data=.,#
			id.vars=c(#
				population.grouping.variables,#
				"N"#
			),#
			value.name="population_variance"#
		)	#
	B$variable <- sub("*_var", "", B$variable)#
	# merge together#
	Z <- A %>%#
		merge(#
			B, #
			by=c(#
				population.grouping.variables, #
				"variable"#
			)#
		)#
	# calculate efficiency#
	Z %<>% mutate(#
		RE = (#
			population_variance/sample.size.variable *#
			(1 - sample.size.variable/N)#
		)#
		/	mean_MSE#
	)#
	Z$variable <- paste(Z$variable, "_RE", sep="")#
	Z %<>%#
	reshape2::dcast(#
		list(#
			c(population.grouping.variables, "N", "sample.size.variable"),#
			c("variable")#
		),#
		value.var="RE"#
		)#
	colnames(Z)[names(Z) == "sample.size.variable"] <- sample.size.variable#
	return(Z)#
}
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
# CONFIRM OLD MOTH EVIDENCE MEAN CALCULATED CORRECTLY#
# manually calculated mean of Old Moth Evidence#
patch_data_6 <- patch_data %>% filter(population==6) %>% filter(Stricta==1)#
# function calculated mean#
population_6 <- patch_data_summary_wide %>% filter(population==6)#
# verify that the means are the same#
mean(patch_data_6$Old_Moth_Evidence_Stricta) == population_6$Old_Moth_Evidence_Stricta_ratio_mean#
#
# MANUALLY CALCULATE RE OF OLD MOTH EVIDENCE#
#
sim_data_6_100_ACS <- simdata_all_re %>% filter(#
	population==6, #
	SamplingDesign=="ACS", #
	N.SRSWOR.plots==100,#
	Stricta_mean_observed > 0#
)#
#
mean_MSE <- sum(#
	(#
		# observed#
		sim_data_6_100_ACS$Old_Moth_Evidence_Stricta_ratio_mean_observed - #
		# true#
		population_6$Old_Moth_Evidence_Stricta_ratio_mean#
	)^2#
)/dim(sim_data_6_100_ACS)[1] # n_sims#
RE = (#
	population_6$Old_Moth_Evidence_Stricta_ratio_var/example_bias$N.Total.plots_mean *#
	(1 - example_bias$N.Total.plots_mean/900)#
) /	mean_MSE#
#
# need sample size in population_6#
example_bias = calculateSamplingBias(#
	population_data_summary	= population_6, #
	simulation_data		= sim_data_6_100_ACS, #
	sampling.grouping.variables	= c("N.Total.plots_mean", "N.SRSWOR.plots",     "SamplingDesign"), #
	population.grouping.variables = "population",#
	ovar			= ovar, #
	rvar				= "Old_Moth_Evidence_Stricta"#
)#
RE_values <- calculateRE(#
	population_data = population_6,#
	MSE_ComparisonSamplingDesign = example_bias,#
	population.grouping.variables = "population",#
	sample.size.variable = "N.Total.plots_mean",#
	ovar = ovar,#
	rvar = "Old_Moth_Evidence_Stricta"#
)
RE_values
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript/simulations')
RE
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript')
A <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_mean_RB,#
	MEPR_on_Stricta_ratio_mean_RB,#
	Old_Moth_Evidence_Stricta_ratio_mean_RB#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "RB$(T_{HT})$",#
	variable.name = "Species"#
)#
A$Species <- sub("*_mean_RB", "", A$Species)#
A$`RB$(T_{HT})$` %<>% round(2)#
#
B <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_mean_MSE,#
	MEPR_on_Stricta_ratio_mean_MSE,#
	Old_Moth_Evidence_Stricta_ratio_mean_MSE#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "MSE",#
	variable.name = "Species"#
)#
B$Species <- sub("*_mean_MSE", "", B$Species)#
B$`MSE` %<>% round(4)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript')
C <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_RE,#
	Old_Moth_Evidence_Stricta_ratio_RE,#
	MEPR_on_Stricta_ratio_RE#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "RE$(T_{HT})$",#
	variable.name = "Species"#
)#
C$Species <- sub("*_RE", "", C$Species)#
C$`RE$(T_{HT})$` %<>% round(2)#
#
D <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_var_RB,#
	MEPR_on_Stricta_ratio_var_RB,#
	Old_Moth_Evidence_Stricta_ratio_var_RB#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "RB(var$(T_{HT})$)",#
	variable.name = "Species"#
)#
D$Species <- sub("*_var_RB", "", D$Species)#
D$`RB(var$(T_{HT})$)` %<>% round(2)#
#
temp <- A %>%#
	merge(B, by=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean", #
		"Species",#
		"SamplingDesign"#
	)) %>%#
	merge(C, by=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean", #
		"Species",#
		"SamplingDesign"#
	)) %>%#
	merge(D, by=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean", #
		"Species",#
		"SamplingDesign"#
	)) %>% #
	setnames("population", "Population") %>%#
	setnames("N.SRSWOR.plots", "n1") %>%#
	setnames("N.Total.plots_mean", "$E[\\nu]$")#
levels(temp$Population) <- 1:6#
#
# RACS#
temp2 <- temp %>% #
	arrange(Species, n1, Population) %>%#
	filter(SamplingDesign=="RACS")#
#
Species <- temp2$Species#
#
temp2 %<>% #
	dplyr::select(-SamplingDesign) %>% #
	split(Species)#
# ACS#
temp3 <- temp %>% #
	arrange(Species, n1, Population) %>%#
	filter(SamplingDesign=="ACS")#
Species <- temp3$Species#
temp3 %<>% #
	dplyr::select(-SamplingDesign) %>% #
	split(Species)
head(A)
head(B)
head(C)
setwd('/Users/KSauby/Documents/Projects/ACSampling_project/code/Manuscript')
A <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_mean_RB,#
	MEPR_on_Stricta_ratio_mean_RB,#
	Old_Moth_Evidence_Stricta_ratio_mean_RB#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "RB$(T_{HT})$",#
	variable.name = "Species"#
)#
A$Species <- sub("*_mean_RB", "", A$Species)#
A$`RB$(T_{HT})$` %<>% round(2)#
#
B <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_mean_MSE,#
	MEPR_on_Stricta_ratio_mean_MSE,#
	Old_Moth_Evidence_Stricta_ratio_mean_MSE#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "MSE",#
	variable.name = "Species"#
)#
B$Species <- sub("*_mean_MSE", "", B$Species)#
B$`MSE` %<>% round(4)#
#
C <- simulation_data_summary_table_re %>%#
#filter(SamplingDesign=="ACS") %>%#
dplyr::select(#
	population,#
	N.SRSWOR.plots,#
	N.Total.plots_mean,#
	SamplingDesign,#
	CACA_on_Stricta_ratio_RE,#
	Old_Moth_Evidence_Stricta_ratio_RE,#
	MEPR_on_Stricta_ratio_RE#
) %>%#
reshape2:::melt.data.frame(#
	id.vars=c(#
		"population",#
		"N.SRSWOR.plots",#
		"N.Total.plots_mean",#
		"SamplingDesign"#
	),#
	value.name = "RE$(T_{HT})$",#
	variable.name = "Species"#
)#
C$Species <- sub("*_RE", "", C$Species)#
C$`RE$(T_{HT})$` %<>% round(2)
setwd('/Users/KSauby/Documents/Projects')
setwd("./ACS")#
#setwd("./modresproc")#
devtools::test()#
devtools::document()#
devtools::install()
